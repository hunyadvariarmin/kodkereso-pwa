<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Számít túrák</title>
<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    font-family: Arial, sans-serif;
    background: linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
                url("icons/logo.png") no-repeat center center fixed;
    background-size: cover;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:center;
    position:relative;
    color:white;
}

/* Gombok rácsa – 3 oszlop */
#buttonsContainer {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top:60px;
    z-index:1;
    width: 100%;
    max-width: 520px;
    padding: 0 16px;
}

button {
    padding:14px;
    font-size:20px;
    color:#FFD700;
    background: rgba(0,0,0,0.4);
    border: 2px solid #FFD700;
    border-radius:12px;
    cursor:pointer;
    transition: all 0.3s ease;
}
button:hover {
    background: rgba(255,215,0,0.2);
    transform: scale(1.05);
}

/* Kisebb gombok (ideiglenes) */
button.temp-small {
    padding:10px;
    font-size:16px;
}

/* Alsó gombsor: Vissza + Frissít */
#bottomActions {
    position:absolute;
    bottom:40px;
    left:50%;
    transform: translateX(-50%);
    display:flex;
    gap:20px;
    z-index:1;
    width:80%;
    max-width:400px;
    justify-content:center;
}

#bottomActions button {
    width:48%;
    padding:12px 0;
    font-size:18px;
}
</style>
</head>
<body>

<div id="buttonsContainer">
    <!-- KISEBB gombok -->
    <button data-code="SZ-1000" class="temp-small" onclick="window.location.href='SZ-1000.html'">SZ-1000</button>
    <button data-code="SZ-2"    class="temp-small" onclick="window.location.href='SZ-2.html'">SZ-2</button>
    <button data-code="SZ-4"    class="temp-small" onclick="window.location.href='SZ-4.html'">SZ-4</button>
    <button data-code="SZ-0"    class="temp-small" onclick="window.location.href='SZ-0.html'">SZ-0</button>
    <button data-code="SZ-7"    class="temp-small" onclick="window.location.href='SZ-7.html'">SZ-7</button>
    <button data-code="SZ-9"    class="temp-small" onclick="window.location.href='SZ-9.html'">SZ-9</button>
    <button data-code="SZ-10"   class="temp-small" onclick="window.location.href='SZ-10.html'">SZ-10</button>
    <button data-code="SZ-101"  class="temp-small" onclick="window.location.href='SZ-101.html'">SZ-101</button>

    <!-- NORMÁL gombok -->
    <button data-code="SZ-1"   onclick="window.location.href='SZ-1.html'">SZ-1</button>
    <button data-code="SZ-5"   onclick="window.location.href='SZ-5.html'">SZ-5</button>
    <button data-code="SZ-12"  onclick="window.location.href='SZ-12.html'">SZ-12</button>
    <button data-code="SZ-14"  onclick="window.location.href='SZ-14.html'">SZ-14</button>
    <button data-code="SZ-15"  onclick="window.location.href='SZ-15.html'">SZ-15</button>
    <button data-code="SZ-18"  onclick="window.location.href='SZ-18.html'">SZ-18</button>
    <button data-code="SZ-19"  onclick="window.location.href='SZ-19.html'">SZ-19</button>
    <button data-code="SZ-20"  onclick="window.location.href='SZ-20.html'">SZ-20</button>
    <button data-code="SZ-21"  onclick="window.location.href='SZ-21.html'">SZ-21</button>
    <button data-code="SZ-22"  onclick="window.location.href='SZ-22.html'">SZ-22</button>
    <button data-code="SZ-23"  onclick="window.location.href='SZ-23.html'">SZ-23</button>
    <button data-code="SZ-25"  onclick="window.location.href='SZ-25.html'">SZ-25</button>
    <button data-code="SZ-27"  onclick="window.location.href='SZ-27.html'">SZ-27</button>
    <button data-code="SZ-28"  onclick="window.location.href='SZ-28.html'">SZ-28</button>
    <button data-code="SZ-29"  onclick="window.location.href='SZ-29.html'">SZ-29</button>
    <button data-code="SZ-30"  onclick="window.location.href='SZ-30.html'">SZ-30</button>
    <button data-code="SZ-32"  onclick="window.location.href='SZ-32.html'">SZ-32</button>
    <button data-code="SZ-33"  onclick="window.location.href='SZ-33.html'">SZ-33</button>
    <button data-code="SZ-34"  onclick="window.location.href='SZ-34.html'">SZ-34</button>
    <button data-code="SZ-35"  onclick="window.location.href='SZ-35.html'">SZ-35</button>
    <button data-code="SZ-36"  onclick="window.location.href='SZ-36.html'">SZ-36</button>
    <button data-code="SZ-37"  onclick="window.location.href='SZ-37.html'">SZ-37</button>
    <button data-code="SZ-38"  onclick="window.location.href='SZ-38.html'">SZ-38</button>
    <button data-code="SZ-40"  onclick="window.location.href='SZ-40.html'">SZ-40</button>
</div>

<div id="bottomActions">
    <button id="backButton">Vissza</button>
    <button id="refreshButton">Frissít</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
// Excel fájl
const XLSX_URL = "https://raw.githubusercontent.com/hunyadvariarmin/kodkereso-pwa/main/1.xlsx";

// DONE jelölések – a SZ-*.html oldalakban: done_SZ-...
const DONE_KEYS = [
  "done_SZ-1000","done_SZ-2","done_SZ-4","done_SZ-0","done_SZ-7","done_SZ-9",
  "done_SZ-10","done_SZ-101","done_SZ-1","done_SZ-5","done_SZ-12","done_SZ-14",
  "done_SZ-15","done_SZ-18","done_SZ-19","done_SZ-20","done_SZ-21","done_SZ-22",
  "done_SZ-23","done_SZ-25","done_SZ-27","done_SZ-28","done_SZ-29","done_SZ-30",
  "done_SZ-32","done_SZ-33","done_SZ-34","done_SZ-35","done_SZ-36","done_SZ-37",
  "done_SZ-38","done_SZ-40"
];

// Scanned kulcsok – a SZ-*.html oldalakban: TOUR_ID + "_scannedList"
const SCAN_KEYS = [
  "SZ-1000_scannedList","SZ-2_scannedList","SZ-4_scannedList","SZ-0_scannedList",
  "SZ-7_scannedList","SZ-9_scannedList","SZ-10_scannedList","SZ-101_scannedList",
  "SZ-1_scannedList","SZ-5_scannedList","SZ-12_scannedList","SZ-14_scannedList",
  "SZ-15_scannedList","SZ-18_scannedList","SZ-19_scannedList","SZ-20_scannedList",
  "SZ-21_scannedList","SZ-22_scannedList","SZ-23_scannedList","SZ-25_scannedList",
  "SZ-27_scannedList","SZ-28_scannedList","SZ-29_scannedList","SZ-30_scannedList",
  "SZ-32_scannedList","SZ-33_scannedList","SZ-34_scannedList","SZ-35_scannedList",
  "SZ-36_scannedList","SZ-37_scannedList","SZ-38_scannedList","SZ-40_scannedList"
];

/* Zöld jelölés (DONE) */
function applyDoneStyles() {
    const buttons = document.querySelectorAll('#buttonsContainer button');
    buttons.forEach(btn => {
        btn.style.backgroundColor = "rgba(0,0,0,0.4)";
        btn.style.borderColor = "#FFD700";
        btn.style.color = "#FFD700";
    });

    DONE_KEYS.forEach(key => {
        if (localStorage.getItem(key) === "true") {
            const code = key.replace("done_",""); // pl. done_SZ-2 -> SZ-2
            const btn = document.querySelector(`button[data-code="${code}"]`);
            if (btn) {
                btn.style.backgroundColor = "rgba(0,128,0,0.7)";
                btn.style.borderColor = "#00ff00";
                btn.style.color = "#ffffff";
            }
        }
    });
}

/* Excel alapján: SZ-kódok rugalmasság – SZ-1, SZ-801, SZ-901 stb. */
async function updateButtonsVisibilityFromExcel() {
    try {
        const resp = await fetch(XLSX_URL);
        const buffer = await resp.arrayBuffer();
        const wb = XLSX.read(buffer, { type: "array" });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        // Összegyűjtjük az összes "alap" SZ-kódot: SZ-1, SZ-2, ..., SZ-101 stb.
        // úgy, hogy:
        //  - ha C-ben SZ-1 van, az SZ-1
        //  - ha C-ben SZ-801 van, az is SZ-1 (801-800)
        const excelBaseTours = new Set();

        for (let i = 1; i < data.length; i++) {
            const row = data[i] || [];
            const val = row[2];
            if (val == null) continue;

            const norm = String(val).trim().toUpperCase();
            if (!norm.startsWith("SZ-")) continue;

            const numStr = norm.slice(3); // "801", "1", "901" stb.
            const num = parseInt(numStr, 10);
            if (isNaN(num)) continue;

            let baseNum = num;
            // Ha 800 felett van, akkor 800-at levonunk (SZ-801 -> SZ-1, SZ-901 -> SZ-101)
            if (baseNum >= 800) {
                baseNum = baseNum - 800;
            }

            const baseCode = "SZ-" + baseNum; // pl. SZ-1, SZ-35, SZ-101
            excelBaseTours.add(baseCode.toUpperCase());
        }

        const buttons = document.querySelectorAll('#buttonsContainer button');
        buttons.forEach(btn => {
            const code = btn.getAttribute("data-code"); // pl. "SZ-101"
            if (!code) return;

            const upperCode = code.toUpperCase();

            if (excelBaseTours.has(upperCode)) {
                btn.style.display = "";
            } else {
                btn.style.display = "none";
            }
        });

    } catch (e) {
        console.error("Excel betöltési hiba a Szami oldalon:", e);
        // Hiba esetén inkább mutassuk az összes gombot
        const buttons = document.querySelectorAll('#buttonsContainer button');
        buttons.forEach(btn => {
            btn.style.display = "";
        });
    }
}

window.addEventListener("DOMContentLoaded", () => {
    applyDoneStyles();
    updateButtonsVisibilityFromExcel();

    document.getElementById("backButton").addEventListener("click", () => {
        window.location.href = "arukiadas.html";
    });

    document.getElementById("refreshButton").addEventListener("click", () => {
        const ok = confirm("Biztosan törlöd az összes jelölést és beolvasott kódot?");
        if (!ok) return;

        DONE_KEYS.forEach(k => localStorage.removeItem(k));
        SCAN_KEYS.forEach(k => sessionStorage.removeItem(k));

        applyDoneStyles();
    });
});
</script>

</body>
</html>
