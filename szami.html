<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Szami</title>
<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    font-family: Arial, sans-serif;
    background: linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
                url("icons/logo.png") no-repeat center center fixed;
    background-size: cover;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:center;
    position:relative;
    color:white;
}

/* Gombok rácsa */
#buttonsContainer {
    display:grid;
    grid-template-columns: repeat(2, 150px);
    gap: 20px;
    margin-top:60px;
    z-index:1;
}

button {
    padding:20px;
    font-size:24px;
    color:#FFD700;
    background: rgba(0,0,0,0.4);
    border: 2px solid #FFD700;
    border-radius:12px;
    cursor:pointer;
    transition: all 0.3s ease;
}
button:hover {
    background: rgba(255,215,0,0.2);
    transform: scale(1.05);
}

/* Ideiglenes kisebb gombokhoz */
button.temp-small {
    padding:12px;
    font-size:18px;
}

/* Alsó gombsor: Vissza + Frissít */
#bottomActions {
    position:absolute;
    bottom:40px;
    left:50%;
    transform: translateX(-50%);
    display:flex;
    gap:20px;
    z-index:1;
    width:80%;
    max-width:400px;
    justify-content:center;
}

#bottomActions button {
    width:48%;
    padding:14px 0;
    font-size:20px;
}
</style>
</head>
<body>

<div id="buttonsContainer">
    <!-- A gombokat JS fogja dinamikusan létrehozni -->
</div>

<div id="bottomActions">
    <button id="backButton">Vissza</button>
    <button id="refreshButton">Frissít</button>
</div>

<script>
// Kisebb (ideiglenes) gombok kódjai
const SMALL_CODES = ["1000","2","4","0","7","9","10","101"];

// Normál méretű gombok kódjai
const NORMAL_CODES = [
    "1","5","9","12","14","15","18","19","20","21","22","23",
    "25","27","28","29","30","32","33","34","36","37","38","135"
];

// Összes egyedi kód
const ALL_CODES = Array.from(new Set([...SMALL_CODES, ...NORMAL_CODES]));

// melyik gombhoz melyik localStorage kulcs tartozik (zöld jelölés)
const DONE_MAP = {
    "1000": "done_1000",
    "2":    "done_2",
    "4":    "done_4",
    "0":    "done_0",
    "7":    "done_7",
    "9":    "done_9",
    "10":   "done_10",
    "101":  "done_101",

    "1":   "done_1",
    "5":   "done_5",
    "12":  "done_12",
    "14":  "done_14",
    "15":  "done_15",
    "18":  "done_18",
    "19":  "done_19",
    "20":  "done_20",
    "21":  "done_21",
    "22":  "done_22",
    "23":  "done_23",
    "25":  "done_25",
    "27":  "done_27",
    "28":  "done_28",
    "29":  "done_29",
    "30":  "done_30",
    "32":  "done_32",
    "33":  "done_33",
    "34":  "done_34",
    "36":  "done_36",
    "37":  "done_37",
    "38":  "done_38",
    "135": "done_135"
};

// a szám oldalak sessionStorage kulcsai (beolvasott kódok listája)
const SCAN_KEYS = ALL_CODES.map(code => code + "_scannedList");

// eredeti gombstílus visszaállítása
function resetButtonStyles() {
    const buttons = document.querySelectorAll('#buttonsContainer button');
    buttons.forEach(btn => {
        btn.style.backgroundColor = "rgba(0,0,0,0.4)";
        btn.style.borderColor = "#FFD700";
        btn.style.color = "#FFD700";
    });
}

// zöld jelölések alkalmazása
function applyDoneStyles() {
    resetButtonStyles();

    Object.entries(DONE_MAP).forEach(([label, key]) => {
        if (localStorage.getItem(key) === "true") {
            const btn = document.querySelector(`button[data-code="${label}"]`);
            if (btn) {
                btn.style.backgroundColor = "rgba(0,128,0,0.7)"; // zöld háttér
                btn.style.borderColor = "#00ff00";
                btn.style.color = "#ffffff";
            }
        }
    });
}

// Gombok dinamikus létrehozása – csak azoknak, ahol van beolvasott adat
function buildButtons() {
    const container = document.getElementById("buttonsContainer");
    container.innerHTML = ""; // biztos ami biztos, ürítjük

    ALL_CODES.forEach(code => {
        const key = code + "_scannedList";
        const saved = sessionStorage.getItem(key);
        if (!saved) return; // nincs ilyen kulcs -> nincs gomb

        let arr;
        try {
            arr = JSON.parse(saved);
        } catch(e){
            return; // hibás adat -> inkább ne jelenjen meg
        }

        if (!Array.isArray(arr) || arr.length === 0) return; // üres lista -> ne legyen gomb

        const btn = document.createElement("button");
        btn.dataset.code = code;
        btn.textContent = code;

        if (SMALL_CODES.includes(code)) {
            btn.classList.add("temp-small");
        }

        btn.addEventListener("click", () => {
            window.location.href = code + ".html";
        });

        container.appendChild(btn);
    });
}

// oldal betöltésekor
window.addEventListener("DOMContentLoaded", () => {
    // csak azokhoz csinál gombot, ahol van beolvasott adat
    buildButtons();
    // utána zöldre színezzük, ha done_... true
    applyDoneStyles();

    // Vissza gomb -> Árukiadás oldal
    document.getElementById("backButton").addEventListener("click", () => {
        window.location.href = "arukiadas.html";
    });

    // Frissít gomb -> megerősítés + minden done_* és *_scannedList törlése + gombok eltüntetése
    document.getElementById("refreshButton").addEventListener("click", () => {
        const ok = confirm("Biztosan törlöd az összes jelölést és beolvasott kódot?");
        if (!ok) return;

        // zöld jelölések törlése
        Object.values(DONE_MAP).forEach(key => {
            localStorage.removeItem(key);
        });

        // beolvasott listák törlése
        SCAN_KEYS.forEach(k => {
            sessionStorage.removeItem(k);
        });

        // gombok törlése a felületről
        document.getElementById("buttonsContainer").innerHTML = "";
    });
});
</script>

</body>
</html>
